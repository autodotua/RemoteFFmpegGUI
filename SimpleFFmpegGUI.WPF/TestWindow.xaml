<Window
    x:Class="SimpleFFmpegGUI.WPF.TestWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SimpleFFmpegGUI.WPF"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:panels="clr-namespace:SimpleFFmpegGUI.WPF.Panels"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    Title="FFmpeg 工具箱"
    Width="1400"
    Height="800"
    ui:TitleBar.IsIconVisible="True"
    ui:WindowHelper.UseModernWindowStyle="True"
    AllowDrop="True"
    ResizeMode="NoResize"
    SizeToContent="WidthAndHeight"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <DataGrid
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            CanUserReorderColumns="False"
            CanUserResizeRows="False"
            CanUserSortColumns="False"
            HeadersVisibility="Column"
            IsEnabled="{Binding IsTesting, Converter={StaticResource InverseBoolConverter}}"
            ItemsSource="{Binding Tests}">
            <DataGrid.Columns>
                <DataGridTextColumn Binding="{Binding Header}" />
                <DataGridTemplateColumn
                    Width="120"
                    Header="H264">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ui:SimpleStackPanel Orientation="Horizontal">
                                <CheckBox
                                    Margin="0,0,-80,0"
                                    IsChecked="{Binding Items[0].IsChecked}" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    Text="{Binding Items[0].Score}" />
                            </ui:SimpleStackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn
                    Width="120"
                    Header="H265">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ui:SimpleStackPanel Orientation="Horizontal">
                                <CheckBox
                                    Margin="0,0,-80,0"
                                    IsChecked="{Binding Items[1].IsChecked}" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    Text="{Binding Items[1].Score}" />
                            </ui:SimpleStackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn
                    Width="120"
                    Header="VP9">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ui:SimpleStackPanel Orientation="Horizontal">
                                <CheckBox
                                    Margin="0,0,-80,0"
                                    IsChecked="{Binding Items[2].IsChecked}" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    Text="{Binding Items[2].Score}" />
                            </ui:SimpleStackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
        <TextBlock
            Grid.Row="2"
            Text="{Binding Message}" />
        <ProgressBar
            Grid.Row="4"
            Maximum="12"
            Minimum="0"
            Value="{Binding Progress}" />
        <TextBlock
            Grid.Row="8"
            Opacity="0.7">
            <Run>本测试将模拟不同编码格式和分辨率下视频编码的速度，单位为帧每秒。</Run>
            <LineBreak />
            <Run>测试视频视频长度越长（左），测试耗时越长，测试结果越准确。</Run>
            <LineBreak />
            <Run>速度预设越慢（左），测试耗时越长，测试结果越准确。</Run>
            <LineBreak />
            <Run>不同速度预设、不同测试视频的测试分数没有参考性。</Run>
        </TextBlock>
        <DockPanel
            Grid.Row="6"
            LastChildFill="True">
            <TextBlock
                VerticalAlignment="Center"
                DockPanel.Dock="Left"
                Text="速度预设：" />
            <Slider
                AutoToolTipPlacement="TopLeft"
                IsEnabled="{Binding IsTesting, Converter={StaticResource InverseBoolConverter}}"
                IsSnapToTickEnabled="True"
                Maximum="8"
                Minimum="0"
                TickFrequency="1"
                TickPlacement="BottomRight"
                Value="{Binding Preset}" />
        </DockPanel>
        <ui:SimpleStackPanel
            Grid.Row="99"
            HorizontalAlignment="Right"
            Orientation="Horizontal"
            Spacing="8">
            <Button
                HorizontalAlignment="Right"
                Click="StopButton_Click"
                Content="停止测试"
                Visibility="{Binding IsTesting, Converter={StaticResource Bool2VisibilityConverter}}" />
            <Button
                HorizontalAlignment="Right"
                Click="StartButton_Click"
                Content="开始测试"
                Visibility="{Binding IsTesting, Converter={StaticResource Bool2VisibilityConverter}, ConverterParameter=i}" />
        </ui:SimpleStackPanel>
    </Grid>
</Window>