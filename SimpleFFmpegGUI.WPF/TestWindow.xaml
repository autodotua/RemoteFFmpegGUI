<Window
    x:Class="SimpleFFmpegGUI.WPF.TestWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SimpleFFmpegGUI.WPF"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:panels="clr-namespace:SimpleFFmpegGUI.WPF.Panels"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    Title="编码测试 - FFmpeg 工具箱"
    Width="1400"
    ui:TitleBar.IsIconVisible="True"
    ui:WindowHelper.UseModernWindowStyle="True"
    AllowDrop="True"
    Closing="Window_Closing"
    ResizeMode="NoResize"
    ShowInTaskbar="False"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">
    <Grid Margin="8">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="16" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="16" />
            <RowDefinition Height="*" />
            <RowDefinition Height="16" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <GroupBox
            x:Name="grpSpeed"
            Header="速度" />
        <GroupBox
            x:Name="grpSSIM"
            Grid.Row="2"
            Header="画面相似性" />
        <GroupBox
            x:Name="grpPSNR"
            Grid.Row="4"
            Header="画面信噪比" />
        <DockPanel
            Grid.RowSpan="99"
            Grid.Column="2">
            <ui:SimpleStackPanel
                DockPanel.Dock="Top"
                Spacing="8">
                <DockPanel LastChildFill="True">
                    <TextBlock
                        VerticalAlignment="Center"
                        DockPanel.Dock="Left"
                        Text="速度预设：" />
                    <Slider
                        AutoToolTipPlacement="TopLeft"
                        IsEnabled="{Binding IsTesting, Converter={StaticResource InverseBoolConverter}}"
                        IsSnapToTickEnabled="True"
                        Maximum="5"
                        Minimum="0"
                        TickFrequency="1"
                        TickPlacement="BottomRight"
                        Value="{Binding Preset}" />
                </DockPanel>
                <DockPanel LastChildFill="True">
                    <TextBlock
                        VerticalAlignment="Center"
                        DockPanel.Dock="Left"
                        Text="测试编码器：" />
                    <ui:SimpleStackPanel
                        x:Name="stkCodecs"
                        Orientation="Horizontal" />

                </DockPanel>
                <DockPanel LastChildFill="True">
                    <TextBlock
                        VerticalAlignment="Center"
                        DockPanel.Dock="Left"
                        Text="测试分辨率：" />
                    <ui:SimpleStackPanel
                        x:Name="stkSizes"
                        Orientation="Horizontal" />

                </DockPanel>
            </ui:SimpleStackPanel>
            <ui:SimpleStackPanel
                VerticalAlignment="Bottom"
                DockPanel.Dock="Bottom"
                Spacing="8">
                <TextBlock Opacity="0.7">
                    <Run>本测试将模拟不同编码格式和分辨率下视频编码的速度，单位为帧每秒。</Run>
                    <LineBreak />
                    <Run>测试视频视频长度越长，速度预设越慢（左），测试耗时越长，测试结果越准确。</Run>
                    <LineBreak />
                    <Run>不同版本的本软件和FFmpeg、不同速度预设、不同测试视频的测试分数没有参考性。</Run>
                    <LineBreak />
                    <Run>不同分辨率之间的分数无关。</Run>
                </TextBlock>
                <TextBlock Text="{Binding Message}" />
                <ProgressBar
                    Maximum="1"
                    Minimum="0"
                    Value="{Binding DetailProgress}" />
                <ProgressBar
                    Maximum="{Binding MaxProgress}"
                    Minimum="0"
                    Value="{Binding Progress}" />
                <ui:SimpleStackPanel
                    HorizontalAlignment="Right"
                    Orientation="Horizontal"
                    Spacing="8">
                    <Button
                        HorizontalAlignment="Right"
                        Click="StopButton_Click"
                        Content="停止测试"
                        Visibility="{Binding IsTesting, Converter={StaticResource Bool2VisibilityConverter}}" />
                    <Button
                        HorizontalAlignment="Right"
                        Click="StartButton_Click"
                        Content="开始测试"
                        Visibility="{Binding IsTesting, Converter={StaticResource Bool2VisibilityConverter}, ConverterParameter=i}" />
                </ui:SimpleStackPanel>
            </ui:SimpleStackPanel>
        </DockPanel>
    </Grid>
</Window>